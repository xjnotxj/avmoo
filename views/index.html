<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://twitter.github.io/typeahead.js/css/examples.css"
    >

</head>
<style>

    * {
        text-align: center;

    }

    html, body {
        width: 100%;
        height: 100%;
    }

    #title {
        padding-left: 40%;
        padding-right: 40%;
        padding-top: 5%;
    }

    .thumbnail {
        display: block;
        height: 100px;
    }

    #archived {
        position: relative;
        top: 10px;
    }

    .disable {
        filter: gray;
        -webkit-filter: grayscale(100%);
        cursor: no-drop;
    }


</style>
<body>

<input id="keyword_old" type="hidden" value="{{ keyword }}">

<h1><span id="title" class="label label-success">{{ title }}!</span></h1>
<hr/>

<div class="row">

    <div class="col-md-3 col-xs-3">
        <a class="btn-lg" id="archived" href="#">archived <span class="badge">{{archived_number}}</span></a>
    </div>

    <div class="col-md-6 col-xs-6">
        <!--<div id="input" class="input-group input-group-lg  ">-->
        <div id="the-basics"><input
                style="position: relative; vertical-align: top; background-color: transparent;    height: 50px;"
                id="keyword" type="text" class="typeahead tt-input" placeholder="Search for..." value="{{ keyword }}">
        </div>
        <span style="display: none" class="input-group-btn">
        <button class="btn btn-default typeahead" id="go" type="button">Go !</button>
      </span>
        <!--</div>-->
    </div>

    <div class="col-md-3 col-xs-3">
        {% if isFinish == 0 %}
        <button id="finish" class="btn btn-primary btn-lg" type="button">
            Finish it !
        </button>
        {% endif %}
        {% if isFinish == 1 %}
        <button id="cancelFinish" class="btn btn-default btn-lg" type="button">
            cancel Finished
        </button>
        {% endif %}
    </div>

</div>

<hr/>
<div class="jumbotron">
    <div class="row">
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="https://www.douban.com/search?source=suggest&q={{ keyword }}"
               class="thumbnail"
               style=" background: url('/images/douban.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
                mobile</a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="#" class="thumbnail disable"
               style="color: white; background: url('/images/dedao.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
                mobile </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="https://baike.baidu.com/item/%E6%99%93%E8%AF%B4/5821620?fr=aladdin#4"
               class="thumbnail"
               style=" background: url('/images/xiaoshuo.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank"
               href="https://baike.baidu.com/item/%E6%99%93%E6%9D%BE%E5%A5%87%E8%B0%88/13779682?fr=aladdin#5"
               class="thumbnail"
               style=" background: url('/images/xiaosongqitan.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="https://search.bilibili.com/all?keyword={{ keyword }}&page=1&order=totalrank"
               class="thumbnail"
               style=" background: url('/images/bilibili.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="https://www.youtube.com/results?search_query={{ keyword }}" class="thumbnail"
               style=" background: url('/images/youtube.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="https://www.baidu.com/s?ie=UTF-8&wd={{ keyword }}" class="thumbnail"
               style=" background: url('/images/baidu.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank"
               href="https://www.google.co.jp/search?newwindow=1&ei=WL5TWvCLAoym8QWB8a34DQ&q={{ keyword }}&oq={{ keyword }}"
               class="thumbnail"
               style=" background: url('/images/google.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="https://www.zhihu.com/search?type=content&q={{ keyword }}" class="thumbnail"
               style=" background: url('/images/zhihu.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>
        <div class="col-xs-6 col-md-3">
            <a target="_blank" href="http://www.juzimi.com/search/node/{{ keyword }}%20type:sentence" class="thumbnail"
               style=" background: url('/images/juzimi.jpeg');background-repeat: no-repeat; background-size: contain;     background-position: 50% 50%;">
            </a>
        </div>

    </div>


</div>

</body>

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/typeahead.js/0.11.0/typeahead.jquery.min.js"></script>

<script>
    //archived
    $("#archived").click(function () {
//        location.href =
        window.open("/search/archived")
    })

    var substringMatcher = function (strs) {
        return function findMatches(q, cb) {
            var matches, substringRegex;

            // an array that will be populated with substring matches
            matches = [];

            // regex used to determine if a string contains the substring `q`
            substrRegex = new RegExp(q, 'i');

            // iterate through the pool of strings and for any string that
            // contains the substring `q`, add it to the `matches` array
            $.each(strs, function (i, str) {
                if (substrRegex.test(str)) {
                    matches.push(str);
                }
            });

            cb(matches);
        };
    };

    var states = [];
    $("#keyword").typeahead({
                hint: true,
                highlight: true,
                minLength: 1
            },
            {
                name: 'states',
                source: substringMatcher(states)
            });

    $("#keyword").bind('input propertychange', function () {
        var val = $(this).val();
        if (!val) {
            return;
        }
        $.ajax({
            url: "/search/search/?page=1&size=0&search=" + val,
            method: "GET",
        })
                .done(function (data) {

                    let states = [];
                    if (data.value.list.length === 0) {
                        return;
                    }

                    for (let n  of data.value.list) {
                        states.push(n.keyword);
                    }
                    console.log(states)
                    $('#keyword').typeahead('destroy');
                    $("#keyword").typeahead({
                                hint: true,
                                highlight: true,
                                minLength: 1
                            },
                            {
                                name: 'states',
                                source: substringMatcher(states)
                            });

                    $("#keyword").focus();

                }).fail(function (err) {
            alert(err);
        })
    })


    //go
    $("#go").click(function () {
        var keyword = $("#keyword").val();
        location.href = "/?keyword=" + keyword
    })

    //finish
    $("#finish").click(function () {

        $.ajax({
            url: "/search/finish/?keyword=" + $("#keyword_old").val(),
            method: "POST",
            data: {
                type: 1
            }
        })
                .done(function (data) {
                    location.reload();
                }).fail(function (err) {
            alert(err);
        })

    })

    //finish
    $("#cancelFinish").click(function () {

        $.ajax({
            url: "/search/finish/?keyword=" + $("#keyword_old").val(),
            method: "POST",
            data: {
                type: 0
            }
        })
                .done(function (data) {
                    location.reload();
                }).fail(function (err) {
            alert(err);
        })

    })


    $(".thumbnail").click(function () {

        if (!$(this).hasClass("disable")) {
            $(this).addClass("disable");
        } else {
            return false;
        }

    })

    $('body').bind('keyup', function (event) {
        if (event.keyCode == "13") {
            //回车执行查询
            $("#go").click();
        }
    });


</script>

</html>
